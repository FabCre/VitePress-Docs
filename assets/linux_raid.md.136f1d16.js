import{_ as s,c as a,o as e,d as n}from"./app.b958bfe6.js";const l="/VitePress-Docs/assets/disks-kde-1.89e8a377.png",t="/VitePress-Docs/assets/create-raid.dce23699.png",p="/VitePress-Docs/assets/watch-mdstat-sync.2dbc4d82.png",D=JSON.parse('{"title":"Créer un RAID 1 chiffré","description":"","frontmatter":{},"headers":[{"level":2,"title":"Mdadm","slug":"mdadm","link":"#mdadm","children":[]},{"level":2,"title":"Preparer les disques","slug":"preparer-les-disques","link":"#preparer-les-disques","children":[]},{"level":2,"title":"Créer le raid","slug":"creer-le-raid","link":"#creer-le-raid","children":[]},{"level":2,"title":"Monter automatiquement le raid","slug":"monter-automatiquement-le-raid","link":"#monter-automatiquement-le-raid","children":[]},{"level":2,"title":"En cas de panne d’un disque dur","slug":"en-cas-de-panne-d-un-disque-dur","link":"#en-cas-de-panne-d-un-disque-dur","children":[]}],"relativePath":"linux/raid.md"}'),o={name:"linux/raid.md"},r=n(`<h1 id="creer-un-raid-1-chiffre" tabindex="-1">Créer un RAID 1 chiffré <a class="header-anchor" href="#creer-un-raid-1-chiffre" aria-hidden="true">#</a></h1><h2 id="mdadm" tabindex="-1">Mdadm <a class="header-anchor" href="#mdadm" aria-hidden="true">#</a></h2><p>Installer mdadm si il n&#39;est pas disponible et activer le service.</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mdadm</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mdadm</span></span>
<span class="line"></span></code></pre></div><h2 id="preparer-les-disques" tabindex="-1">Preparer les disques <a class="header-anchor" href="#preparer-les-disques" aria-hidden="true">#</a></h2><p>Avec un gestionnaire de partitions, chiffrer et creer les partitions sur les disques.</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Affiche les disques</span></span>
<span class="line"><span style="color:#FFCB6B;">fdisk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-l</span></span>
<span class="line"></span></code></pre></div><p><img src="`+l+`" alt="disks"></p><h2 id="creer-le-raid" tabindex="-1">Créer le raid <a class="header-anchor" href="#creer-le-raid" aria-hidden="true">#</a></h2><p>Dans l&#39;exemple, lancer la commande en choisissant le nom du raid <code>/dev/md***</code>.</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mdadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/md120</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--level=mirror</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--raid-devices=2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sd[c-d]</span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span></code></pre></div><p><img src="`+t+`" alt="disks"></p><p>Ensuite, la synchronisation des disques s&#39;effectue.</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Pour voir l&#39;avancement</span></span>
<span class="line"><span style="color:#FFCB6B;">watch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/proc/mdstat</span></span>
<span class="line"></span></code></pre></div><p><img src="`+p+`" alt="disks"></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Pour voir les details du raid</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mdadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--detail</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/md120</span></span>
<span class="line"></span></code></pre></div><h2 id="monter-automatiquement-le-raid" tabindex="-1">Monter automatiquement le raid <a class="header-anchor" href="#monter-automatiquement-le-raid" aria-hidden="true">#</a></h2><p>Dans le fichier <code>/etc/fstab</code> ajouter une ligne a la fin du fichier avec les bonnes options :</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># /etc/fstab: static file system information.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Use &#39;blkid&#39; to print the universally unique identifier for a device; this may</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># be used with UUID= as a more robust way to name devices that works even if</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># disks are added and removed. See fstab(5).</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># &lt;file system&gt;             &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;  &lt;dump&gt;  &lt;pass&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">UUID</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">E799-2B00</span><span style="color:#A6ACCD;">                            /boot/efi      vfat    umask</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0077</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#FFCB6B;">/dev/mapper/luks-7a4ad3ac-f22f-4567-9a1d-07d7b2e38178</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;">              </span><span style="color:#C3E88D;">ext4</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">defaults,noatime</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#FFCB6B;">/dev/md120</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/run/media/panda/d5afc656-bc4a-4b1a-800b-d24f2bb7bc9c</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ext4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">defaults,nofail,discard</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span></code></pre></div><h2 id="en-cas-de-panne-d-un-disque-dur" tabindex="-1">En cas de panne d’un disque dur <a class="header-anchor" href="#en-cas-de-panne-d-un-disque-dur" aria-hidden="true">#</a></h2><p>Identifier le disque defaillant avec un SMART et le remplacer par un disque fonctionnel de la même taille. Il faut ensuite créé une nouvelle table de partition avec un seule partition non formatée, exactement comme si vous devez créer un RAID avec ce disque.</p><p>Ajouter le disque dans le RAID voulu <code>/dev/md***</code> :</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mdadm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--manage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/md0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/sdc1</span></span>
<span class="line"></span></code></pre></div>`,24),c=[r];function i(d,C,u,y,m,h){return e(),a("div",null,c)}const f=s(o,[["render",i]]);export{D as __pageData,f as default};
