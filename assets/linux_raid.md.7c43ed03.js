import{_ as s,o as a,c as n,Q as e}from"./chunks/framework.31db9f4a.js";const l="/VitePress-Docs/assets/disks-kde-1.89e8a377.png",p="/VitePress-Docs/assets/create-raid.dce23699.png",o="/VitePress-Docs/assets/watch-mdstat-sync.2dbc4d82.png",t="/VitePress-Docs/assets/partition-raid.68d25e70.png",r="/VitePress-Docs/assets/luks-partition.153fe95a.png",c="/VitePress-Docs/assets/confirm-partition-luks.07119ca4.png",i="/VitePress-Docs/assets/finished-partition-luks.3ff2ae69.png",d="/VitePress-Docs/assets/properties-partition-luks.fa1ab3a2.png",k=JSON.parse('{"title":"Créer un RAID 1","description":"","frontmatter":{},"headers":[],"relativePath":"linux/raid.md","filePath":"linux/raid.md"}'),y={name:"linux/raid.md"},E=e(`<h1 id="creer-un-raid-1" tabindex="-1">Créer un RAID 1 <a class="header-anchor" href="#creer-un-raid-1" aria-label="Permalink to &quot;Créer un RAID 1&quot;">​</a></h1><h2 id="mdadm" tabindex="-1">Mdadm <a class="header-anchor" href="#mdadm" aria-label="Permalink to &quot;Mdadm&quot;">​</a></h2><p>Installer mdadm si il n&#39;est pas disponible et activer le service.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mdadm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mdadm</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mdadm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mdadm</span></span></code></pre></div><h2 id="checker-les-disques" tabindex="-1">Checker les disques <a class="header-anchor" href="#checker-les-disques" aria-label="Permalink to &quot;Checker les disques&quot;">​</a></h2><p>Avec un gestionnaire de partitions ou par fdisk.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Affiche les disques</span></span>
<span class="line"><span style="color:#B392F0;">fdisk</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Affiche les disques</span></span>
<span class="line"><span style="color:#6F42C1;">fdisk</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span></span></code></pre></div><p><img src="`+l+'" alt="disks"></p><h2 id="creer-le-raid" tabindex="-1">Créer le raid <a class="header-anchor" href="#creer-le-raid" aria-label="Permalink to &quot;Créer le raid&quot;">​</a></h2><p>Dans l&#39;exemple, lancer la commande en choisissant le nom du raid <code>/dev/md***</code>.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md120</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--level=mirror</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--raid-devices=2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sd[c-d]1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md120</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--level=mirror</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--raid-devices=2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sd[c-d]1</span></span></code></pre></div><p><img src="'+p+`" alt="disks"></p><p>Ensuite, la synchronisation des disques s&#39;effectue.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Pour voir l&#39;avancement</span></span>
<span class="line"><span style="color:#B392F0;">watch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/proc/mdstat</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Pour voir l&#39;avancement</span></span>
<span class="line"><span style="color:#6F42C1;">watch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/proc/mdstat</span></span></code></pre></div><p><img src="`+o+`" alt="disks"></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Pour voir les details du raid</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--detail</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md120</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Pour voir les details du raid</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--detail</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md120</span></span></code></pre></div><h2 id="creer-et-chiffrer-le-raid" tabindex="-1">Creer et chiffrer le raid <a class="header-anchor" href="#creer-et-chiffrer-le-raid" aria-label="Permalink to &quot;Creer et chiffrer le raid&quot;">​</a></h2><p>Utiliser un outil comme KDE Gestionnaire de partition ou mkfs (via terminal).</p><p>Creer la partition ext4 avec un chiffrement luks. <img src="`+t+'" alt="disks"></p><p>Definir un mot de passe. <img src="'+r+'" alt="disks"></p><p><img src="'+c+'" alt="disks"></p><p>Le raid est maintenant chiffre et peut etre monte. <img src="'+i+'" alt="disks"></p><p><img src="'+d+`" alt="disks"></p><h2 id="monter-automatiquement-le-raid" tabindex="-1">Monter automatiquement le raid <a class="header-anchor" href="#monter-automatiquement-le-raid" aria-label="Permalink to &quot;Monter automatiquement le raid&quot;">​</a></h2><h3 id="raid-non-chiffre" tabindex="-1">Raid non chiffre <a class="header-anchor" href="#raid-non-chiffre" aria-label="Permalink to &quot;Raid non chiffre&quot;">​</a></h3><p>Dans le fichier <code>/etc/fstab</code> ajouter une ligne a la fin du fichier avec les bonnes options :</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># /etc/fstab: static file system information.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Use &#39;blkid&#39; to print the universally unique identifier for a device; this may</span></span>
<span class="line"><span style="color:#6A737D;"># be used with UUID= as a more robust way to name devices that works even if</span></span>
<span class="line"><span style="color:#6A737D;"># disks are added and removed. See fstab(5).</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># &lt;file system&gt;             &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;  &lt;dump&gt;  &lt;pass&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">UUID</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">E799-2B00</span><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">/boot/efi</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">vfat</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">umask=</span><span style="color:#79B8FF;">0077</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#B392F0;">/dev/mapper/luks-7a4ad3ac-f22f-4567-9a1d-07d7b2e38178</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">ext4</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">defaults,noatime</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">/dev/md120</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/run/media/panda/d5afc656-bc4a-4b1a-800b-d24f2bb7bc9c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ext4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">defaults,nofail,discard</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># /etc/fstab: static file system information.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Use &#39;blkid&#39; to print the universally unique identifier for a device; this may</span></span>
<span class="line"><span style="color:#6A737D;"># be used with UUID= as a more robust way to name devices that works even if</span></span>
<span class="line"><span style="color:#6A737D;"># disks are added and removed. See fstab(5).</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># &lt;file system&gt;             &lt;mount point&gt;  &lt;type&gt;  &lt;options&gt;  &lt;dump&gt;  &lt;pass&gt;</span></span>
<span class="line"><span style="color:#24292E;">UUID</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">E799-2B00</span><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">/boot/efi</span><span style="color:#24292E;">      </span><span style="color:#032F62;">vfat</span><span style="color:#24292E;">    </span><span style="color:#032F62;">umask=</span><span style="color:#005CC5;">0077</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#6F42C1;">/dev/mapper/luks-7a4ad3ac-f22f-4567-9a1d-07d7b2e38178</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;">              </span><span style="color:#032F62;">ext4</span><span style="color:#24292E;">    </span><span style="color:#032F62;">defaults,noatime</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">/dev/md120</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/run/media/panda/d5afc656-bc4a-4b1a-800b-d24f2bb7bc9c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ext4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">defaults,nofail,discard</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span></code></pre></div><h3 id="raid-chiffre" tabindex="-1">Raid chiffre <a class="header-anchor" href="#raid-chiffre" aria-label="Permalink to &quot;Raid chiffre&quot;">​</a></h3><p>Il n&#39;est pas considerer comme une bonne pratique de monte automatiquement un raid chiffre.</p><h2 id="en-cas-de-panne-d-un-disque-dur" tabindex="-1">En cas de panne d’un disque dur <a class="header-anchor" href="#en-cas-de-panne-d-un-disque-dur" aria-label="Permalink to &quot;En cas de panne d’un disque dur&quot;">​</a></h2><p>Identifier le disque defaillant avec un SMART et le remplacer par un disque fonctionnel de la même taille. Il faut ensuite créé une nouvelle table de partition avec un seule partition non formatée, exactement comme si vous devez créer un RAID avec ce disque.</p><p>Ajouter le disque dans le RAID voulu <code>/dev/md***</code> :</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--manage</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sdc1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--manage</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sdc1</span></span></code></pre></div><h2 id="supprimer-un-raid" tabindex="-1">Supprimer un RAID <a class="header-anchor" href="#supprimer-un-raid" aria-label="Permalink to &quot;Supprimer un RAID&quot;">​</a></h2><p>Stopper puis supprimer le raid.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">umount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">umount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md0</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--stop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md0</span></span>
<span class="line"><span style="color:#B392F0;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sd</span><span style="color:#79B8FF;">**</span></span>
<span class="line"><span style="color:#B392F0;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/md0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sd</span><span style="color:#79B8FF;">**</span></span>
<span class="line"><span style="color:#B392F0;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--zero-superblock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sd</span><span style="color:#79B8FF;">**</span></span>
<span class="line"><span style="color:#B392F0;">mdadm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--zero-superblock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sd</span><span style="color:#79B8FF;">**</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--stop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md0</span></span>
<span class="line"><span style="color:#6F42C1;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sd</span><span style="color:#005CC5;">**</span></span>
<span class="line"><span style="color:#6F42C1;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/md0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sd</span><span style="color:#005CC5;">**</span></span>
<span class="line"><span style="color:#6F42C1;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--zero-superblock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sd</span><span style="color:#005CC5;">**</span></span>
<span class="line"><span style="color:#6F42C1;">mdadm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--zero-superblock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sd</span><span style="color:#005CC5;">**</span></span></code></pre></div><h2 id="vitesse-de-la-synchronisation-des-volumes" tabindex="-1">Vitesse de la synchronisation des volumes <a class="header-anchor" href="#vitesse-de-la-synchronisation-des-volumes" aria-label="Permalink to &quot;Vitesse de la synchronisation des volumes&quot;">​</a></h2><p>Augmenter la limite de la vitesse de synchronisation des volumes.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Définir une valeur maximale de 100MB/s</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/proc/sys/dev/raid/speed_limit_max</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Définir une valeur minimale de 10MB/s</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/proc/sys/dev/raid/speed_limit_min</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Définir une valeur maximale de 100MB/s</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/proc/sys/dev/raid/speed_limit_max</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Définir une valeur minimale de 10MB/s</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/proc/sys/dev/raid/speed_limit_min</span></span></code></pre></div>`,41),u=[E];function m(h,F,v,C,g,f){return a(),n("div",null,u)}const B=s(y,[["render",m]]);export{k as __pageData,B as default};
